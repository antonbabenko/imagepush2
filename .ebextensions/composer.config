commands:
  00-create-webapp-home-dir: # Fix for "sh: line 0: cd: /home/webapp: No such file or directory" in elasticbeanstalk
    command: mkdir -p /home/webapp && chown webapp:webapp /home/webapp && chown 700 /home/webapp
    ignoreErrors: true
  01-install-mongo-ext:
    command: "yes '' | pecl install -f mongo-1.5.8"
    ignoreErrors: true
  02-update-composer:
    command: export COMPOSER_HOME=/root && /usr/bin/composer.phar self-update

option_settings:
  - namespace: aws:elasticbeanstalk:application:environment
    option_name: COMPOSER_HOME
    value: /root
  # List options from parameters.yml which should be created. Note: real values should be changed using AWS Console
  - option_name: SYMFONY_ENV
    value: prod
  - option_name: SYMFONY_DEBUG
    value: 0
  - option_name: SYMFONY__ENV__FILESYSTEMS_IMAGES_ADAPTER
    value: prod
  - option_name: SYMFONY__ENV__CDN_IMAGES_URL
    value: http://cdn.imagepush.to
  - option_name: SYMFONY__ENV__SITE_URL
    value: http://imagepush.to
  # List secret keys below
  - option_name: SYMFONY__ENV__MAILER_USER
    value: placeholder-value-change-me
  - option_name: SYMFONY__ENV__MAILER_PASSWORD
    value: placeholder-value-change-me
  - option_name: SYMFONY__ENV__AWS_KEY
    value: placeholder-value-change-me
  - option_name: SYMFONY__ENV__AWS_SECRET_KEY
    value: placeholder-value-change-me
  - option_name: SYMFONY__ENV__AWS_DYNAMODB_KEY
    value: placeholder-value-change-me
  - option_name: SYMFONY__ENV__AWS_DYNAMODB_SECRET_KEY
    value: placeholder-value-change-me
  - option_name: SYMFONY__ENV__BITLY_USERNAME
    value: placeholder-value-change-me
  - option_name: SYMFONY__ENV__BITLY_API_KEY
    value: placeholder-value-change-me

container_commands:
#    100-install-nodejs:
#        command: "source .ebextensions/bin/install-nodejs.sh"
#    200-copy-apache-config:
#        command: "cp .ebextensions/apache/site.conf /etc/httpd/conf.d/site.conf"
    300-run-composer:
        command: "composer.phar install --no-dev --optimize-autoloader --prefer-dist --no-interaction"
#    400-install-npm-packages:
#        command: "npm install"
#    425-install-bower-packages:
#        command: "bower install --allow-root"
#    450-run-grunt:
#        command: "grunt production"
#    550-dump-assets:
#        command: "php app/console assetic:dump"
#    600-update-cache:
#        command: "source .ebextensions/bin/update-cache.sh"
#    700-remove-dev-app:
#        command: "rm web/app_dev.php"
#    800-run-cron:
#        command: "crontab .ebextensions/cron/main"
#    900-notify-deployment:
#        command: "php app/console newrelic:notify-deployment --user=eb"